version: 2.1
executors:
  node-executor:
    docker:
      - image: circleci/node:10.15
    working_directory: ~/repo

jobs:
  print:
    executor: node-executor
    environment:
      - GIT_BASE_REVISION: << pipeline.git.base_revision >>
      - GIT_CURRENT_REVISION: << pipeline.git.revision >>
    steps:
      - checkout
      - run: BUMP_VERSION_COMMITS=$(git log $GIT_BASE_REVISION..$GIT_CURRENT_REVISION --pretty=format:%h:%s | grep "(release): \?v*.*.*$" -n)
      - run: echo ===
      - run: echo $GIT_BASE_REVISION
      - run: echo ===
      - run: echo $GIT_CURRENT_REVISION
      - run: echo ===
      - run: echo $BUMP_VERSION_COMMITS
      - run: echo ===
      - run: git remote -v
      - run: echo ===
      - run: echo $(git branch --list -a)
      - run: echo ===

workflows:
  version: 2.1
  print_infos:
    jobs:
      - print:
          filters:
            branches:
              only:
                - ci-dev
